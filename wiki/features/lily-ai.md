# ğŸ¤– Lily AI

> AI ì–´ì‹œìŠ¤í„´íŠ¸ì™€ ëŒ€í™”í•˜ë©° PRDì™€ í‹°ì¼“ì„ ìë™ ìƒì„±í•˜ì„¸ìš”.

## ê°œìš”

LilyëŠ” LilPMì— ë‚´ì¥ëœ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ê¸°íš, PRD ì‘ì„±, ê°œë°œ í‹°ì¼“ ìƒì„±ì„ ëŒ€í™”í˜• ì¸í„°í˜ì´ìŠ¤ë¡œ ì§€ì›í•©ë‹ˆë‹¤.

## ì§€ì› AI ëª¨ë¸

| ëª¨ë¸ | ì œê³µì | íŠ¹ì§• |
|------|--------|------|
| ğŸŸ£ **Claude Sonnet** | Anthropic | ì½”ë“œ ë¶„ì„, ë³µì¡í•œ ì¶”ë¡ ì— ê°•ì  |
| ğŸŸ¢ **GPT-4o** | OpenAI | ë²”ìš© AI, ë¹ ë¥¸ ì‘ë‹µ |
| ğŸ”µ **Gemini Pro** | Google | ë©€í‹°ëª¨ë‹¬, ê¸´ ì»¨í…ìŠ¤íŠ¸ |

## ì£¼ìš” ê¸°ëŠ¥

### 1. ëŒ€í™”í˜• ê¸°íš

```
ì‚¬ìš©ì: ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ì‹¶ì–´
Lily: ì¸ì¦ ê¸°ëŠ¥ì— ëŒ€í•´ ìì„¸íˆ ì•Œë ¤ì£¼ì„¸ìš”. 
      - ì†Œì…œ ë¡œê·¸ì¸ì´ í•„ìš”í•œê°€ìš”?
      - ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•œê°€ìš”?
      - 2FAë¥¼ ì§€ì›í•  ê±´ê°€ìš”?
```

### 2. PRD ìë™ ìƒì„±

1. ëŒ€í™”ë¥¼ í†µí•´ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
2. "PRD ìƒì„±í•˜ê¸°" ë²„íŠ¼ í´ë¦­
3. AIê°€ êµ¬ì¡°í™”ëœ PRD ë¬¸ì„œ ìƒì„±
4. PRD í˜ì´ì§€ì—ì„œ í¸ì§‘ ë° ì €ì¥

### 3. í‹°ì¼“ ìë™ ìƒì„±

```
Lily: ë‹¤ìŒ í‹°ì¼“ë“¤ì„ ì œì•ˆë“œë¦½ë‹ˆë‹¤:

[ì œì•ˆëœ ì´ìŠˆ]
1. ğŸ« ì´ë©”ì¼ ì¸ì¦ API êµ¬í˜„
   ìš°ì„ ìˆœìœ„: ë†’ìŒ
   [ìˆ˜ë½] [ê±°ì ˆ]

2. ğŸ« ë¡œê·¸ì¸ í˜ì´ì§€ UI êµ¬í˜„
   ìš°ì„ ìˆœìœ„: ì¤‘ê°„
   [ìˆ˜ë½] [ê±°ì ˆ]

[ëª¨ë‘ ìˆ˜ë½]
```

### 4. Canvas ëª¨ë“œ

ì‹¤ì‹œê°„ ì½”ë“œ ìƒì„± ë° ë¯¸ë¦¬ë³´ê¸°:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ëŒ€í™”ì°½          â”‚     Canvas          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì‚¬ìš©ì: ë¡œê·¸ì¸ í¼    â”‚ [ì½”ë“œ] [ë¯¸ë¦¬ë³´ê¸°]    â”‚
â”‚        ë§Œë“¤ì–´ì¤˜     â”‚                     â”‚
â”‚                     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ Lily: ë§Œë“¤ê³         â”‚   â”‚ Login Form  â”‚   â”‚
â”‚       ìˆìŠµë‹ˆë‹¤...   â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚                     â”‚   â”‚ Email: ___  â”‚   â”‚
â”‚                     â”‚   â”‚ Pass: ___   â”‚   â”‚
â”‚                     â”‚   â”‚ [Login]     â”‚   â”‚
â”‚                     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ëŒ€í™” ê´€ë¦¬

### ëŒ€í™” ì €ì¥ ë° ëª©ë¡

ëŒ€í™”ëŠ” ìë™ ì €ì¥ë˜ë©° ì‚¬ì´ë“œë°”ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤:

```tsx
// LilyChat.tsx ì‚¬ì´ë“œë°” êµ¬ì¡°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â• New Chat              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Œ Pinned               â”‚
â”‚   ğŸ“Œ ì¤‘ìš” ëŒ€í™” 1         â”‚
â”‚   ğŸ“Œ ì¤‘ìš” ëŒ€í™” 2         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ• Recent               â”‚
â”‚   ğŸ’¬ ì˜¤ëŠ˜ì˜ ëŒ€í™”         â”‚
â”‚   ğŸ’¬ ì–´ì œ ëŒ€í™”           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì¬ì •ë ¬

`@dnd-kit` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ ëŒ€í™” ìˆœì„œ ì¬ì •ë ¬:

```tsx
// LilyChat.tsx (SortableContext ì‚¬ìš©)
import { DndContext, closestCenter } from '@dnd-kit/core';
import { SortableContext, useSortable } from '@dnd-kit/sortable';

// ë“œë˜ê·¸ í•¸ë“¤ ì•„ì´ì½˜
<GripVertical className="h-3 w-3 text-muted-foreground" />
```

**ì§€ì› ê¸°ëŠ¥:**
- ğŸ“Œ ê³ ì • ëŒ€í™” í•€/ì–¸í•€
- âœï¸ ëŒ€í™” ì´ë¦„ ë³€ê²½
- ğŸ—‘ï¸ ëŒ€í™” ì‚­ì œ
- ğŸ”€ ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½

### ëŒ€í™” ê³µìœ 

ëŒ€í™”ë¥¼ ì™¸ë¶€ ì‚¬ìš©ìì™€ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Share Conversation                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”— Share Link:                          â”‚
â”‚  [https://app.com/lily/shared/abc123]   â”‚
â”‚                                          â”‚
â”‚  âš™ï¸ Settings:                            â”‚
â”‚  â˜‘ Allow comments                        â”‚
â”‚  â˜‘ Require authentication               â”‚
â”‚                                          â”‚
â”‚  [Copy Link] [Remove Share]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ê³µìœ  ê´€ë ¨ í…Œì´ë¸”

```sql
-- conversation_shares í…Œì´ë¸”
CREATE TABLE conversation_shares (
  id UUID PRIMARY KEY,
  conversation_id UUID REFERENCES conversations(id) ON DELETE CASCADE,
  shared_by UUID REFERENCES auth.users(id),
  share_token TEXT UNIQUE NOT NULL,
  is_public BOOLEAN DEFAULT false,
  allow_comments BOOLEAN DEFAULT false,
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- conversation_access_requests í…Œì´ë¸”  
CREATE TABLE conversation_access_requests (
  id UUID PRIMARY KEY,
  conversation_id UUID REFERENCES conversations(id) ON DELETE CASCADE,
  requested_by UUID REFERENCES auth.users(id),
  status TEXT CHECK (status IN ('pending', 'approved', 'rejected')),
  message TEXT,
  reviewed_by UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT now()
);
```

## ì—ë””í„° ê¸°ëŠ¥ (BlockEditor)

### TipTap ê¸°ë°˜ Rich Text Editor

```tsx
// BlockEditor.tsxì—ì„œ ì‚¬ìš©í•˜ëŠ” ì£¼ìš” í™•ì¥
const extensions = [
  StarterKit,
  Table.configure({ resizable: true }),
  TableRow,
  TableHeader,
  CustomTableCell,  // ë°°ê²½ìƒ‰, ë„ˆë¹„ ì§€ì›
  Highlight.configure({ multicolor: true }),
  TaskList,
  TaskItem,
  Link,
  ResizableImage,
  CodeBlockLowlight,
  // Notion-style blocks
  CalloutNode,
  ToggleNode,
  VideoNode,
  EquationNode,
];
```

### í…Œì´ë¸” ê³ ê¸‰ ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| í–‰/ì—´ ì¶”ê°€/ì‚­ì œ | Add Row Above/Below, Add Column Left/Right |
| ì…€ ë³‘í•©/ë¶„ë¦¬ | Merge Cells, Split Cell |
| í—¤ë” í† ê¸€ | Toggle Header Row/Column |
| **ì…€ ë°°ê²½ìƒ‰** | 8ê°€ì§€ í”„ë¦¬ì…‹ ìƒ‰ìƒ (Red, Orange, Yellow, Green, Blue, Purple, Pink, Gray) |
| **ì…€ ë„ˆë¹„ ì¡°ì ˆ** | ë“œë˜ê·¸ë¡œ ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì ˆ |

#### CustomTableCell í™•ì¥

```typescript
// BlockEditor.tsx
const CustomTableCell = TableCell.extend({
  addAttributes() {
    return {
      ...this.parent?.(),
      backgroundColor: {
        default: null,
        parseHTML: element => element.getAttribute('data-background-color'),
        renderHTML: attributes => {
          if (!attributes.backgroundColor) return {};
          return {
            'data-background-color': attributes.backgroundColor,
            style: `background-color: ${attributes.backgroundColor}`,
          };
        },
      },
      colwidth: {
        default: null,
        parseHTML: element => {
          const colwidth = element.getAttribute('colwidth');
          return colwidth ? colwidth.split(',').map(w => parseInt(w, 10)) : null;
        },
        renderHTML: attributes => {
          if (!attributes.colwidth) return {};
          return { colwidth: attributes.colwidth.join(',') };
        },
      },
    };
  },
});
```

#### ì…€ ë°°ê²½ìƒ‰ ë©”ë‰´

```tsx
// í…Œì´ë¸” ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ìƒ‰ìƒ ì„ íƒ
<DropdownMenu>
  <DropdownMenuTrigger>
    <Paintbrush /> Cell Background
  </DropdownMenuTrigger>
  <DropdownMenuContent>
    {[
      { name: 'Red', color: '#FEE2E2' },
      { name: 'Orange', color: '#FFEDD5' },
      { name: 'Yellow', color: '#FEF3C7' },
      { name: 'Green', color: '#DCFCE7' },
      { name: 'Blue', color: '#DBEAFE' },
      { name: 'Purple', color: '#F3E8FF' },
      { name: 'Pink', color: '#FCE7F3' },
      { name: 'Gray', color: '#F3F4F6' },
    ].map(({ name, color }) => (
      <DropdownMenuItem
        onClick={() => editor.chain().focus()
          .setCellAttribute('backgroundColor', color).run()}
      >
        <div style={{ backgroundColor: color }} /> {name}
      </DropdownMenuItem>
    ))}
  </DropdownMenuContent>
</DropdownMenu>
```

## API í‚¤ ì„¤ì •

### ì„¤ì • ë°©ë²•

1. **ì„¤ì • í˜ì´ì§€**: `/settings/ai` ì—ì„œ ì„¤ì •
2. **ëª¨ë‹¬ ì…ë ¥**: Lily ìµœì´ˆ ì‚¬ìš© ì‹œ ëª¨ë‹¬ì—ì„œ ì…ë ¥

### ì €ì¥ ìœ„ì¹˜

API í‚¤ëŠ” Supabase `user_ai_settings` í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤:

```sql
user_ai_settings (
  user_id UUID,
  anthropic_api_key TEXT,
  openai_api_key TEXT,
  gemini_api_key TEXT,
  default_provider TEXT,
  auto_mode_enabled BOOLEAN
)
```

## ê¸°ìˆ  êµ¬í˜„

### ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ

Server-Sent Events (SSE)ë¥¼ í†µí•œ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°:

```typescript
// LilyChat.tsx
const response = await fetch('/functions/v1/lily-chat', {
  method: 'POST',
  body: JSON.stringify({ messages, provider, stream: true }),
});

const reader = response.body?.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  const chunk = decoder.decode(value);
  // ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ì²˜ë¦¬
}
```

### Thinking ë¸”ë¡

Claudeì˜ ì‚¬ê³  ê³¼ì • í‘œì‹œ:

```typescript
// <thinking> íƒœê·¸ íŒŒì‹±
const thinkingMatch = content.match(/<thinking>([\s\S]*?)<\/thinking>/);
if (thinkingMatch) {
  thinkingContent = thinkingMatch[1];
  cleanContent = content.replace(/<thinking>[\s\S]*?<\/thinking>/g, '').trim();
}
```

### ì¶”ì²œ ì´ìŠˆ

```typescript
// SuggestedIssuesList ì»´í¬ë„ŒíŠ¸
interface SuggestedIssue {
  title: string;
  description: string;
  priority: 'urgent' | 'high' | 'medium' | 'low';
}

// ìˆ˜ë½ ì‹œ ì‹¤ì œ ì´ìŠˆë¡œ ìƒì„±
onAcceptIssue={(index, issue) => {
  await createIssue(teamId, issue);
  acceptSuggestedIssue(index);
}}
```

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### conversations í…Œì´ë¸”

```sql
CREATE TABLE conversations (
  id UUID PRIMARY KEY,
  team_id UUID REFERENCES teams(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT,
  is_pinned BOOLEAN DEFAULT false,
  sort_order FLOAT,  -- ë“œë˜ê·¸ ì¬ì •ë ¬ìš©
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
```

### messages í…Œì´ë¸”

```sql
CREATE TABLE messages (
  id UUID PRIMARY KEY,
  conversation_id UUID REFERENCES conversations(id) ON DELETE CASCADE,
  role TEXT CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  thinking_content TEXT,  -- Claude thinking ë¸”ë¡
  suggested_issues JSONB,
  created_at TIMESTAMPTZ DEFAULT now()
);
```

## í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§

### ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

```
ë‹¹ì‹ ì€ Lily, LilPMì˜ AI ì œí’ˆ ê¸°íš ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

ì—­í• :
- í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ ë¶„ì„
- PRD ë¬¸ì„œ ì‘ì„± ì§€ì›
- ê°œë°œ í‹°ì¼“ ìƒì„± ì œì•ˆ

ì‘ë‹µ ê·œì¹™:
1. í•œêµ­ì–´ë¡œ ì‘ë‹µ (ì‚¬ìš©ì ì–¸ì–´ì— ë§ì¶¤)
2. êµ¬ì¡°í™”ëœ í˜•ì‹ ì‚¬ìš©
3. ì‹¤í–‰ ê°€ëŠ¥í•œ í‹°ì¼“ ì œì•ˆ

ì»¨í…ìŠ¤íŠ¸:
- í˜„ì¬ í”„ë¡œì íŠ¸: {projectName}
- íŒ€: {teamName}
- ê¸°ì¡´ ì´ìŠˆ ìˆ˜: {issueCount}
```

## MCP í†µí•© (Model Context Protocol)

LilyëŠ” MCP ë„êµ¬ë¥¼ í†µí•´ ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```typescript
// lily-chat Edge Functionì—ì„œ MCP ë„êµ¬ í˜¸ì¶œ
// mcpTools íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ì „ë‹¬
const response = await fetch('/functions/v1/lily-chat', {
  body: JSON.stringify({
    messages,
    mcpTools: [{ name: 'search_web', endpoint: '...', apiKey: '...' }],
  }),
});
```

ìì„¸í•œ ë‚´ìš©: [MCP í†µí•©](./mcp.md)

## ë©€í‹°ëª¨ë‹¬ ì§€ì›

ì´ë¯¸ì§€ì™€ íŒŒì¼ì„ ì²¨ë¶€í•˜ì—¬ AIì™€ ëŒ€í™”:

```typescript
// ì´ë¯¸ì§€ ë°ì´í„° ì „ì†¡
const response = await fetch('/functions/v1/lily-chat', {
  body: JSON.stringify({
    messages,
    imageData: { base64: '...', mimeType: 'image/png' },
  }),
});
```

## Lovable Gateway í´ë°±

ì‚¬ìš©ì API í‚¤ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ Lovable Gatewayë¥¼ í´ë°±ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

**ê´€ë ¨ ë¬¸ì„œ**
- [PRD](./prd.md)
- [ì´ìŠˆ ê´€ë¦¬](./issues.md)
- [MCP í†µí•©](./mcp.md)
- [ë¸”ë¡ ì—ë””í„°](./block-editor.md)
- [API ì„¤ê³„](../architecture/api.md)
- [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](../architecture/database.md)

